(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{484:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("p",[t._v("为了演示Hutool-http的http请求功能，因此这个栗子用红薯家的开源资讯开刀，在此做个简单的Demo。")]),t._v(" "),s("h2",{attrs:{id:"开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始"}},[t._v("#")]),t._v(" 开始")]),t._v(" "),s("h3",{attrs:{id:"分析页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析页面"}},[t._v("#")]),t._v(" 分析页面")]),t._v(" "),s("ol",[s("li",[t._v("打开红薯家的主页，我们找到最显眼的开源资讯模块，然后点击“更多”，打开“开源资讯”板块。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19204312_zJD8.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("打开F12调试器，点击快捷键F12打开Chrome的调试器，点击“Network”选项卡，然后在页面上点击“全部资讯”。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19204634_1ahd.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19204743_eJBy.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("由于红薯家的列表页是通过下拉翻页的，因此下拉到底部会触发第二页的加载，此时我们下拉到底部，然后观察调试器中是否有新的请求出现。如图，我们发现第二个请求是列表页的第二页。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19205000_V7Sj.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("我们打开这个请求地址，可以看到纯纯的内容。红框所指地址为第二页的内容，很明显p参数代表了页码page。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19205156_dTb8.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[t._v("我们右键点击后查看源码，可以看到源码。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19205356_lQBd.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[t._v("找到标题部分的HTML源码，然后搜索这个包围标题的HTML部分，看是否可以定位标题。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19205448_Cn4w.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19205601_HgAv.png",alt:""}})]),t._v(" "),s("p",[t._v("至此分析完毕，我们拿到了列表页的地址，也拿到了可以定位标题的相关字符（在后面用正则提取标题用），就可以开始使用Hutool编码了。")]),t._v(" "),s("h3",{attrs:{id:"模拟http请求爬取页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模拟http请求爬取页面"}},[t._v("#")]),t._v(" 模拟Http请求爬取页面")]),t._v(" "),s("p",[t._v("使用Hutool-http配合ReUtil请求并提取页面内容非常简单，代码如下：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//请求列表页")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" listContent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpUtil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.oschina.net/action/ajax/get_more_news_list?newsType=&p=2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//使用正则获取所有标题")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" titles "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReUtil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<span class=\\"text-ellipsis\\">(.*?)</span>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" listContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" title "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" titles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//打印标题")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("抓取结果为：\n"),s("img",{attrs:{src:"https://static.oschina.net/uploads/img/201711/19210437_aJDc.png",alt:""}})]),t._v(" "),s("p",[t._v("其实核心就前两行代码，第一行请求页面内容，第二行正则定位所有标题行并提取标题部分。")]),t._v(" "),s("p",[t._v("这里我解释下正则部分：ReUtil.findAll方法用于查找所有匹配正则表达式的内容部分，第二个参数"),s("code",[t._v("1")]),t._v("表示提取第一个括号（分组）中的内容，"),s("code",[t._v("0")]),t._v("表示提取所有正则匹配到的内容。这个方法可以看下core模块中ReUtil章节了解详情。")]),t._v(" "),s("p",[s("code",[t._v('<span class=\\"text-ellipsis\\">(.*?)</span>')]),t._v("这个正则就是我们上面分析页面源码后得到的正则，其中"),s("code",[t._v("(.*?)")]),t._v("表示我们需要的内容，"),s("code",[t._v(".")]),t._v("表示任意字符，"),s("code",[t._v("*")]),t._v("表示0个或多个，"),s("code",[t._v("?")]),t._v("表示最短匹配，整个正则的意思就是。，以"),s("code",[t._v('<span class=\\"text-ellipsis\\">')]),t._v("开头，"),s("code",[t._v("</span>")]),t._v("结尾的中间所有字符，中间的字符要达到最短。"),s("code",[t._v("?")]),t._v("的作用其实就是将范围限制到最小，不然"),s("code",[t._v("</span>")]),t._v("很可能匹配到后面去了。")]),t._v(" "),s("p",[t._v("关于正则表达式这块可以看下我的博客："),s("a",{attrs:{href:"http://luxiaolei.com/regex-guide",target:"_blank",rel:"noopener noreferrer"}},[t._v("正则表达式简明参考"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"结语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[t._v("#")]),t._v(" 结语")]),t._v(" "),s("p",[t._v("不得不说，抓取本身并不困难，尤其配合Hutool会让这项工作变得更加简单快速，而其中的难点便是分析页面和定位我们需要的内容。")]),t._v(" "),s("p",[t._v("真正的内容抓取分为四个部分：")]),t._v(" "),s("ul",[s("li",[t._v("找到列表页（很多网站都没有一个总的列表页）")]),t._v(" "),s("li",[t._v("请求列表页，获取详情页地址")]),t._v(" "),s("li",[t._v("请求详情页并使用正则匹配我们需要的内容")]),t._v(" "),s("li",[t._v("入库或将内容保存为文件")])]),t._v(" "),s("p",[t._v("而且在抓取过程中我们也会遇到各种问题，包括但不限于：")]),t._v(" "),s("ul",[s("li",[t._v("封IP")]),t._v(" "),s("li",[t._v("对请求Header有特殊要求")]),t._v(" "),s("li",[t._v("对Cookie有特殊要求")]),t._v(" "),s("li",[t._v("验证码")])]),t._v(" "),s("p",[t._v("这些问题都有一些解决办法，具体要在具体的开发中分析解决。")]),t._v(" "),s("p",[t._v("希望大家看到这个栗子有所启发，也为Hutool提供更多更好的意见~")])])}),[],!1,null,null,null);s.default=e.exports}}]);